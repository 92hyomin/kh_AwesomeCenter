<?xml version="1.0" encoding="UTF-8"?>


<!-- ====  mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체 내에서 유일해야 한다.) -->
<mapper namespace="awesomeAdmin">

	<select id="boardListWithPaging" resultType="com.center.admin.model.BoardVO" parameterType="HashMap">
       select Not_seq, Not_title, Not_regDate
       from 
       (
	       select rownum AS rno, Not_seq, Not_title, Not_regDate
	       from    
	       (  
	         select Not_seq, Not_title ,to_char(Not_regDate, 'yyyy-mm-dd') AS Not_regDate
			 from AdminNotice
			 where Not_status = 1
			 <if test='searchWord != "" '>
             	and ${searchType} like '%'|| #{searchWord} ||'%'
             </if>
			 order by Not_seq desc
		   ) V  
	   ) T 	   
	   where rno between #{startRno} and #{endRno}
    </select>
    
    <!-- === #118. 검색조건이 없을 경우 총 게시물 건수(totalCount) -->
    <select id="getTotalCountWithNOsearch" resultType="int">
    	select count(*)
    	from AdminNotice
    	where Not_status = 1
    </select>
    
    <!-- === #121. 검색조건이 있을 경우 총 게시물 건수(totalCount) -->
    <select id="getTotalCountWithSearch" parameterType="HashMap" resultType="int">
    	select count(*)
    	from AdminNotice
    	where Not_status = 1
    	and ${searchType} like '%'|| #{searchWord} ||'%'
    </select>
    
	<!--  공지 상세글 보여주기  -->
	<select id="getNoticeBoardDetail" parameterType="String" resultType="com.center.admin.model.BoardVO">
       select previousseq, previoustitle, 
             Not_seq, fk_userid, Not_title, Not_content, Not_regDate,
             nextseq, nexttitle 
           
      from 
      (
          select lag(Not_seq, 1) over(order by Not_seq desc) as nextseq
               , lag(Not_title, 1) over(order by Not_seq desc) as nexttitle
               , Not_seq, fk_userid, Not_title, Not_content
               , to_char(Not_regDate, 'yyyy-mm-dd') AS Not_regDate
               , lead(Not_seq, 1) over(order by Not_seq desc) as previousseq
               , lead(Not_title, 1) over(order by Not_seq desc) as previoustitle
          from AdminNotice
          where Not_status = 1
      ) V
      where V.Not_seq = #{Not_seq}
   </select>
   
   <!-- 공지게시판에 글 작성하기 -->
   <insert id="addNotice" parameterType="com.center.admin.model.BoardVO"> 
       insert into AdminNotice(Not_seq, fk_userid, Not_title, Not_content, Not_regDate, Not_status)
  	   values(seq_AdminNotice_Not_seq.nextval, #{fk_userid}, #{Not_title}, #{Not_content}, sysdate, 1) 
   </insert>
</mapper>