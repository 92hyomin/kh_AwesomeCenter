<?xml version="1.0" encoding="UTF-8"?>


<!-- ====  mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체 내에서 유일해야 한다.) -->
<mapper namespace="awesomeAdmin">

	<select id="boardListWithPaging" resultType="com.center.admin.model.BoardVO" parameterType="HashMap">
       select Not_seq, Not_title, Not_regDate
       from 
       (
	       select rownum AS rno, Not_seq, Not_title, Not_regDate
	       from    
	       (  
	         select Not_seq, Not_title ,to_char(Not_regDate, 'yyyy-mm-dd') AS Not_regDate
			 from AdminNotice
			 where Not_status = 1
			 <if test='searchWord != "" '>
             	and ${searchType} like '%'|| #{searchWord} ||'%'
             </if>
			 order by Not_seq desc
		   ) V  
	   ) T 	   
	   where rno between #{startRno} and #{endRno}
    </select>
    
    <!-- === #118. 검색조건이 없을 경우 총 게시물 건수(totalCount) -->
    <select id="getTotalCountWithNOsearch" resultType="int">
    	select count(*)
    	from AdminNotice
    	where Not_status = 1
    </select>
    
    <!-- === #121. 검색조건이 있을 경우 총 게시물 건수(totalCount) -->
    <select id="getTotalCountWithSearch" parameterType="HashMap" resultType="int">
    	select count(*)
    	from AdminNotice
    	where Not_status = 1
    	and ${searchType} like '%'|| #{searchWord} ||'%'
    </select>
    
	<!--  공지 상세글 보여주기  -->
	<select id="getNoticeBoardDetail" parameterType="String" resultType="com.center.admin.model.BoardVO">
       select nopreviousseq, noprevioussubject, 
		       not_seq, not_title, not_content,
		       nonextseq, nonextsubject 
           
      from 
      (
         select lag(not_seq, 1) over(order by not_seq desc) as nonextseq
		         , lag(not_title, 1) over(order by not_seq desc) as nonextsubject
		         , not_seq, not_title, not_content
		         , lead(not_seq, 1) over(order by not_seq desc) as nopreviousseq
		         , lead(not_title, 1) over(order by not_seq desc) as noprevioussubject
          from AdminNotice
          where Not_status = 1
      ) V
      where V.Not_seq = #{Not_seq}
   </select>
   
   <!-- 공지게시판에 글 작성하기 -->
   <insert id="addNotice" parameterType="com.center.admin.model.BoardVO"> 
       insert into AdminNotice(Not_seq, fk_userid, Not_title, Not_content, Not_regDate, Not_status)
  	   values(seq_AdminNotice_Not_seq.nextval, #{fk_userid}, #{not_title}, #{not_content}, sysdate, 1) 
   </insert>
   
   <!-- 공지게시판 글 수정하기 -->
    <update id="noticeEdit" parameterType="com.center.admin.model.BoardVO">
      update AdminNotice set not_title = #{not_title}
                    , not_content = #{not_content}
                    , not_regdate = sysdate
      where Not_seq = #{not_seq}
    </update>
    
    <!-- 공지게시판 글 삭제하기 -->
    <update id="noticedel" parameterType="com.center.admin.model.BoardVO">
      update AdminNotice set not_status=0
      where Not_seq = #{not_seq}
    </update>
    
    <!-- 회원목록 보기 -->
    <select id="memberListWithPaging" resultType="com.center.admin.model.BoardVO" parameterType="HashMap">
       select userno, userid, username, email, addr1, addr2, registerday, status
       from AWESOME_MEMBER
    </select>
</mapper>